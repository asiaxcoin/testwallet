<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WalletConnect Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@web3modal/ethers@5.1.5/dist/index.global.js"></script>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">

    <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center border border-gray-700">
        <h1 class="text-2xl font-bold mb-6 text-cyan-400">Connection Tester</h1>
        
        <div id="connectionStatus" class="mb-4 text-sm text-gray-400">
            Status: <span id="statusText" class="text-red-500 font-bold">Disconnected</span>
        </div>

        <div id="walletInfo" class="hidden mb-6 p-4 bg-gray-900 rounded-lg break-all text-xs text-green-400 border border-green-900">
            <p class="font-bold text-gray-500 mb-1 uppercase">Connected Address:</p>
            <span id="userAddress">0x...</span>
        </div>

        <button id="connectBtn" class="w-full bg-cyan-500 hover:bg-cyan-600 text-black font-bold py-3 rounded-xl transition-all">
            Connect Wallet
        </button>
        
        <button id="disconnectBtn" class="hidden w-full mt-4 bg-red-500/20 hover:bg-red-500/40 text-red-500 font-bold py-2 rounded-xl transition-all">
            Disconnect
        </button>

        <p class="mt-6 text-[10px] text-gray-500 italic">
            Make sure your Project ID is whitelisted on cloud.walletconnect.com
        </p>
    </div>

    <script>
        // 1. Apni Project ID yahan paste karein
        const projectId = '03a163dd191beb8051bf05273501ae42';

        // 2. Network Setup (Polygon)
        const polygon = {
          chainId: 137,
          name: 'Polygon',
          currency: 'POL',
          explorerUrl: 'https://polygonscan.com',
          rpcUrl: 'https://polygon-rpc.com'
        };

        // 3. Web3Modal Configuration
        const { createWeb3Modal, defaultConfig } = window.Web3ModalEthers;
        const modal = createWeb3Modal({
          ethersConfig: defaultConfig({ 
              metadata: { 
                  name: 'Test Project', 
                  description: 'Testing WalletConnect ID', 
                  url: window.location.origin, 
                  icons: ['https://avatars.githubusercontent.com/u/37784886'] 
              } 
          }),
          chains: [polygon],
          projectId,
          themeMode: 'dark'
        });

        const connectBtn = document.getElementById('connectBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const statusText = document.getElementById('statusText');
        const walletInfo = document.getElementById('walletInfo');
        const userAddress = document.getElementById('userAddress');

        // 4. Update UI Function
        async function updateUI() {
            const walletProvider = modal.getWalletProvider();
            const isConnected = modal.getIsConnected();

            if (isConnected && walletProvider) {
                const provider = new ethers.BrowserProvider(walletProvider);
                const signer = await provider.getSigner();
                const address = await signer.getAddress();

                statusText.innerText = "Connected âœ…";
                statusText.className = "text-green-500 font-bold";
                userAddress.innerText = address;
                
                walletInfo.classList.remove('hidden');
                disconnectBtn.classList.remove('hidden');
                connectBtn.innerText = "Wallet Connected";
                connectBtn.disabled = true;
            } else {
                statusText.innerText = "Disconnected";
                statusText.className = "text-red-500 font-bold";
                walletInfo.classList.add('hidden');
                disconnectBtn.classList.add('hidden');
                connectBtn.innerText = "Connect Wallet";
                connectBtn.disabled = false;
            }
        }

        // 5. Button Listeners
        connectBtn.addEventListener('click', async () => {
            try {
                await modal.open();
            } catch (err) {
                console.error("Modal Error:", err);
            }
        });

        disconnectBtn.addEventListener('click', async () => {
            await modal.disconnect();
            location.reload(); // Refresh to clear state
        });

        // 6. Watch for changes
        modal.subscribeProvider(({ isConnected }) => {
            updateUI();
        });

        // Check on initial load
        window.addEventListener('load', () => {
            setTimeout(updateUI, 1000);
        });
    </script>
</body>
</html>
