<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AsiaX Pro Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@web3modal/ethers@5.1.5/dist/index.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        html, body { background-color: #000; color: #fff; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .gold-grad-text { background: linear-gradient(180deg, #FFD700 0%, #B8860B 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .bg-card { background-color: #0D0D0D; border: 1px solid #1A1A1A; border-radius: 12px; margin-bottom: 15px; padding: 15px; }
        .btn-gold { background: linear-gradient(180deg, #FFD700 0%, #B8860B 100%); color: #000; font-weight: bold; border-radius: 8px; width: 100%; padding: 10px; cursor: pointer; text-align: center; }
        .input-box { background: #111; border: 1px solid #222; color: #fff; border-radius: 6px; padding: 12px; width: 100%; font-size: 13px; margin-top: 5px; }
        .app-container { max-width: 410px; margin: 0 auto; padding: 12px; }
        .box-header-logo { width: 140px; margin: 20px auto 10px; display: block; }
        .roi-progress-bg { width: 100%; background: #1A1A1A; height: 8px; border-radius: 10px; margin-top: 10px; border: 1px solid #222; overflow: hidden; }
        .roi-progress-fill { height: 100%; background: linear-gradient(90deg, #22c55e, #00F5FF); width: 0%; transition: 0.5s; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="text-center py-4">
        <img src="prologo.png" class="mx-auto mb-4" style="width: 150px;">
        <button id="walletBtn" class="btn-gold">CONNECT 2WALLET</button>
    </div>

    <div class="bg-card">
        <p class="text-[10px] text-gray-500 uppercase font-bold">My Wallet Address</p>
        <div id="userAddr" class="input-box truncate">Not Connected</div>
        
        <p class="text-[10px] text-gray-500 uppercase font-bold mt-3">Upline</p>
        <div id="uplineAddrDisplay" class="input-box truncate">0x000...000</div>
    </div>

    <img src="income.png" class="box-header-logo">
    <div class="bg-card text-center">
        <p class="text-[10px] text-gray-400 uppercase tracking-widest">Total Income</p>
        <h2 class="text-3xl font-bold mt-2"><span id="totalIncomeDisplay">0.00</span> <span class="gold-grad-text">AX</span></h2>
    </div>

    <img src="invest.png" class="box-header-logo">
    <div class="bg-card">
        <div class="flex justify-between text-[10px] mb-2">
            <span>DEPOSIT: <b id="totalDeposit">0.00 AX</b></span>
            <span class="text-cyan-400">LIMIT: <b id="roiLimitDisplay">0.00</b></span>
        </div>
        <div class="roi-progress-bg"><div id="roiBar" class="roi-progress-fill"></div></div>
    </div>

    <img src="reffer.png" class="box-header-logo">
    <div class="flex gap-2 mb-4">
        <input type="text" id="refLink" readonly class="input-box flex-1" value="Connect First">
        <button onclick="copyText('refLink')" class="btn-gold !w-20">COPY</button>
    </div>

    <div class="bg-card">
        <p class="text-[11px] mb-2">Buy AsiaX (Fixed Swap)</p>
        <input type="number" id="buyUsdtInput" placeholder="USDT Amount" class="input-box mb-3">
        <button onclick="buyAsiaXFix()" class="btn-gold !bg-cyan-500">BUY NOW</button>
    </div>

    <div class="bg-card">
        <p class="text-[11px] mb-2">Invest in Network</p>
        <input type="text" id="uplineInput" placeholder="Referrer Address" class="input-box mb-2">
        <input type="number" id="investAmount" placeholder="AX Amount" class="input-box mb-3">
        <button onclick="invest()" class="btn-gold">INVEST NOW</button>
    </div>
</div>

<script>
    // --- SETTINGS ---
    const projectId = '03a163dd191beb8051bf05273501ae42'; // <--- APNI PROJECT ID YAHAN DALO
    const MAIN_ADDR = "0xF6d0d72AAf0Bbf5C459E680f1e6E75E3B1ce1f06";
    const BUY_FIX_ADDR = "0xCA275a92B4845f3caD2995FaeC00733849C4e6D1";
    const TOKEN_ADDR = "0xE36b5223d488322fAc2dDda937E5aB226E83Fbbd";
    const USDT_ADDR = "0xc2132D05D31c914a87C6611C10748AEb04B58e8F";

    const polygon = {
      chainId: 137,
      name: 'Polygon',
      currency: 'POL',
      explorerUrl: 'https://polygonscan.com',
      rpcUrl: 'https://polygon-rpc.com'
    };

    // --- INITIALIZE WEB3MODAL ---
    const { createWeb3Modal, defaultConfig } = window.Web3ModalEthers;
    const modal = createWeb3Modal({
      ethersConfig: defaultConfig({ 
          metadata: { name: 'AsiaX Pro', description: 'Dashboard', url: window.location.origin, icons: [] } 
      }),
      chains: [polygon],
      projectId: projectId,
      themeMode: 'dark'
    });

    let provider, signer, mainContract, tokenContract, usdtContract, buyFixContract;

    // --- CORE FUNCTIONS ---
    async function startLogic() {
        const walletProvider = modal.getWalletProvider();
        if (!walletProvider) return;

        provider = new ethers.BrowserProvider(walletProvider);
        signer = await provider.getSigner();
        const address = await signer.getAddress();

        // UI Update
        document.getElementById('userAddr').innerText = address;
        document.getElementById('walletBtn').innerText = address.substring(0,6) + "..." + address.substring(38);
        document.getElementById('refLink').value = window.location.origin + window.location.pathname + "?ref=" + address;

        // Init Contracts
        const simpleABI = [
            "function userBasic(address) view returns (address referrer, uint256 totalInvestment, uint256 firstInvestmentTime, uint256 lastROICalculation, uint256 totalWithdrawn, uint256 sponsorIncome, uint256 generationIncome, uint256 totalROIWithdrawn, uint256 totalPoolIncomeWithdrawn, uint256 totalSponsorWithdrawn, uint256 totalGenerationWithdrawn)",
            "function getUserIncome(address) view returns (uint256 pendingROI, uint256 sponsorInc, uint256 generationInc, uint256 poolRewards, uint256 totalWithdrawn)",
            "function invest(address, uint256) external",
            "function approve(address, uint256) external returns (bool)",
            "function buyAsiaX(uint256) external"
        ];

        mainContract = new ethers.Contract(MAIN_ADDR, simpleABI, signer);
        tokenContract = new ethers.Contract(TOKEN_ADDR, simpleABI, signer);
        usdtContract = new ethers.Contract(USDT_ADDR, simpleABI, signer);
        buyFixContract = new ethers.Contract(BUY_FIX_ADDR, simpleABI, signer);

        loadUserData(address);
    }

    async function loadUserData(addr) {
        try {
            const basic = await mainContract.userBasic(addr);
            const income = await mainContract.getUserIncome(addr);
            
            document.getElementById('uplineAddrDisplay').innerText = basic.referrer;
            document.getElementById('totalDeposit').innerText = ethers.formatUnits(basic.totalInvestment, 18) + " AX";
            document.getElementById('totalIncomeDisplay').innerText = ethers.formatUnits(income.totalWithdrawn, 18);
            
            // Progress Bar
            const invested = Number(ethers.formatUnits(basic.totalInvestment, 18));
            if(invested > 0) {
                const limit = invested * 1.75;
                const withdrawn = Number(ethers.formatUnits(basic.totalROIWithdrawn, 18));
                const percent = (withdrawn / limit) * 100;
                document.getElementById('roiBar').style.width = Math.min(percent, 100) + "%";
                document.getElementById('roiLimitDisplay').innerText = limit.toFixed(2);
            }
        } catch(e) { console.error(e); }
    }

    // --- BUTTON ACTIONS ---
    document.getElementById('walletBtn').onclick = () => modal.open();

    modal.subscribeProvider(({ isConnected }) => {
        if (isConnected) startLogic();
    });

    async function invest() {
        const amt = document.getElementById('investAmount').value;
        const ref = document.getElementById('uplineInput').value || "0x0000000000000000000000000000000000000000";
        if(!amt) return alert("Enter amount");
        try {
            const val = ethers.parseUnits(amt, 18);
            await (await tokenContract.approve(MAIN_ADDR, val)).wait();
            await (await mainContract.invest(ref, val)).wait();
            alert("Invested!"); startLogic();
        } catch(e) { alert("Error in transaction"); }
    }

    function copyText(id) {
        const input = document.getElementById(id);
        input.select();
        navigator.clipboard.writeText(input.value);
        alert("Copied!");
    }

    // Check on load
    window.onload = startLogic;
</script>
</body>
</html>





